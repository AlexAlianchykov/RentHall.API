# RentHall.API
Проект представляет собой RESTful API на C# с использованием подхода Code First и Entity Framework Core. Архитектура проекта придерживается принципов Чистой архитектуры Роберта Мартина (Дяди Боба). В проекте используется богатая доменная модель с подходом DDD (Domain-Driven Design). В основе API лежит четкое разделение слоев: Домен (объекты значений, сущности, агрегаты и абстракции), Приложение (сервисы и бизнес-правила), Инфраструктура (доступ к данным и внешние сервисы) и Презентация (контроллеры). Внедрение зависимостей (DI) через IoC-контейнер позволяет управлять зависимостями и изолировать логику для легкого тестирования и расширяемости. Все слои четко разделены, с минимальными связями между ними, а доменная логика сконцентрирована в богатых моделях, которые включают бизнес-правила и инварианты. Также в проекте есть аутентификация, хеширование пароля и логика авторизации на основе ролей. Аутентификация происходит с помощью создания JWT-токена, который затем хранится в cookie. 
## Что делает проект 
RentHall.API разработан как API для управления конференц-залами, их бронирования, расчёта стоимости услуг, а также аналитики. Клиент может найти свободный зал и забронировать его на определённое время, при этом узнать точную стоимость бронирования. Стоимость бронирования зависит от длительности аренды зала, а также дополнительных услуг и времени бронирования. У админа есть возможность проводить стандартные CRUD операции с залами, а также дополнительными услугами и доступ к аналитике.   
## Архитектура проекта 
На основе принципов Чистой архитектуры Роберта Мартина (Дяди Боба) была разработана следующая архитектура:
<br><br>
![image](https://github.com/user-attachments/assets/038fbf02-46f9-4b7d-9f82-56e2f2cf854e)
<br><br>
### В слое Core:
1) Спроектирована доменная логика в богатых моделях, которые включают бизнес-правила, валидацию.
2) Также он содержит абстракции.

Основная цель слоя Core — сосредоточить всю бизнес-логику и правила предметной области. Core не знает, как данные будут храниться или передаваться. Весь доступ к данным осуществляется через абстракции, такие как репозитории или сервисы.
<br><br>
Сам слой Domain организован следущим способом, есть 2 агрегата: 
##### 1) AggregateHall
   
У которого aggregate root - Hall.

C сущностями:
   1. Hall (у него есть Value Object - Price)
   2. Booking
   3. AdditionalServices (у него есть Value Object - Price)

##### 2) AggregateUser
   
У которого aggregate root - User.

C сущностями:
   1. User (у него есть Value Object - Email)

<br><br>
### В слое Application:
Реализованы сервисы и абстракции. Сам слой Application является промежуточным между доменным слоем (где находится бизнес-логика) и внешними слоями. Основная цель слоя Application — это координация бизнес-логики и обработка запросов приложения, но при этом он не должен содержать саму бизнес-логику. Этот слой отвечает за то, как использовать доменные объекты и сервисы для достижения конкретных задач.

<br><br>
### В слое DataAccess:
Созданы сущности, которые будут храниться в БД, настроены их конфигурации, и здесь находится ApplicationDbContext, с помощью которого выполняются CRUD-операции. Также здесь расположены репозитории, где непосредственно обрабатываются CRUD-операции. Основная задача слоя DataAccess — физическое чтение и запись данных в базу данных, а также выполнение сложных запросов и манипуляций с данными. Также в слое DataAccess хранятся и управляются миграции базы данных для изменения её схемы в соответствии с изменениями в моделях.

Структура базы данных выглядит следующим образом:
![image](https://github.com/user-attachments/assets/d52838eb-13d6-496b-8c4f-25f1e32118d2)

<br><br>
### В слое Presentation:
Pеализованы контроллеры, контракты(Dto), а также регистрация зависимостей. Слой Presentation отвечает за взаимодействие с пользователями, он принимает Http-запросы от пользователя и отвечает за передачу их в соответствующие сервисы, и возвращение результата клиенту. Он не содержит бизнес-логику или сложные операции с данными.

В API 4 контроллера:

1) AuthenticationController
С запросами на:

1. Аутентификацию
2. Логин

![image](https://github.com/user-attachments/assets/7badc949-9c6e-447b-b693-b52702ca9a4c)


2) UserController
С запросами на:

1. Поиск доступных залов
2. Просмотр дополнительных сервисов зала
3. Бронирование зала
4. Просмотр списка бронирований у конкретного пользователя
5. Удаление брони зала

![image](https://github.com/user-attachments/assets/c567bc50-cd15-4f6d-8f27-2e2f11645ad2)


3) AdminController
С запросами на:

1. Просмотр списка всех пользователей
2. Удаление пользователя
3. Просмотр списка всех дополнительных услуг
4. Создание новой дополнительной услуги
5. Обновление дополнительной услуги
6. Удаление дополнительной услуги
7. Просмотр списка всех залов
8. Добавление нового зала
9. Обновление информации о зале
10. Удаление зала

![image](https://github.com/user-attachments/assets/35f5ea27-edb3-48d2-a169-9b6a6a0c5c2c)


4) AnalyticsController
С запросами на:

1. Вывод всей аналитики

![image](https://github.com/user-attachments/assets/9de20bdb-72c4-4766-843c-5c9cf73aa1fa)

У каждого контроллера свой сценарий авторизации, и если пользователь ему не соответствует, то он не может выполнять запросы, и появляется ошибка 401.

## Страничка анализа экспериментов 

В проекте реализован HttpGet-запрос возвращающий html-страничку анализа работы api.
В которой есть таблицы : 
1) Спрос на конференц-залы
   
![image](https://github.com/user-attachments/assets/c1c7a517-089d-4aa9-bf23-37d7650d9be4)

2) Спрос на дополнительные услуги
   
![image](https://github.com/user-attachments/assets/985496b6-7df8-495a-883e-1810ab4b5ef8)

3) Количество пользователей
   
![image](https://github.com/user-attachments/assets/d376fcde-9752-42b9-ba79-f1ad1d3e2a4c)


## Особенности, масштабирование, развитие

Что хотелось бы еще добавить в проект, так это логгер для более гибкого и детального отслеживания работы приложения, а также для обработки ошибок. Кроме того, не помешало бы расширить аналитику, добавив новые методы и параметры. В будущем можно также добавить дополнительные методы для обработки различных запросов, но это уже тема масштабирования и дальнейшей работы над этим API.


## Автор проекта 

Алянчиков Александр 














